#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –≤–∞–ª—é—Ç
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./test_currency_api.sh [BASE_URL] [ADMIN_TOKEN]

BASE_URL=${1:-"http://localhost:8080"}
ADMIN_TOKEN=${2:-""}

echo "üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –≤–∞–ª—é—Ç..."
echo "Base URL: $BASE_URL"
echo ""

# –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –≤–∞–ª—é—Ç
echo "1Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –≤–∞–ª—é—Ç:"
curl -s "$BASE_URL/api/v1/currencies" | jq '.' || echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∞–ª—é—Ç"
echo ""

# –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
echo "2Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç:"
curl -s "$BASE_URL/api/v1/currencies/exchange-rates" | jq '.' || echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É—Ä—Å–æ–≤"
echo ""

# –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞
echo "3Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ USD -> RUB:"
curl -s "$BASE_URL/api/v1/currencies/exchange-rates?from=USD&to=RUB" | jq '.' || echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É—Ä—Å–∞ USD->RUB"
echo ""

# –¢–µ—Å—Ç 4: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç
echo "4Ô∏è‚É£ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è 100 USD –≤ RUB:"
curl -s -X POST "$BASE_URL/api/v1/currencies/convert" \
  -H "Content-Type: application/json" \
  -d '{"amount": 100, "from_currency": "USD", "to_currency": "RUB"}' | jq '.' || echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏"
echo ""

# –¢–µ—Å—Ç 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –∞–¥–º–∏–Ω—Å–∫–∏–π —Ç–æ–∫–µ–Ω)
if [ -n "$ADMIN_TOKEN" ]; then
  echo "5Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç (–∞–¥–º–∏–Ω—Å–∫–∏–π –¥–æ—Å—Ç—É–ø):"
  curl -s -X POST "$BASE_URL/api/v1/admin/currencies/update-rates" \
    -H "Authorization: Bearer $ADMIN_TOKEN" \
    -H "Content-Type: application/json" | jq '.' || echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫—É—Ä—Å–æ–≤"
  echo ""
else
  echo "5Ô∏è‚É£ –ü—Ä–æ–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ (–Ω–µ —É–∫–∞–∑–∞–Ω –∞–¥–º–∏–Ω—Å–∫–∏–π —Ç–æ–∫–µ–Ω)"
  echo "   –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:"
  echo "   ./test_currency_api.sh $BASE_URL YOUR_ADMIN_TOKEN"
  echo ""
fi

echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" 